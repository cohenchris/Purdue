/* quietmalware.c - quietmalware */

#include <xinu.h>

/*------------------------------------------------------------------------------
 * quietmalware - finds out address of local variable x and modifies value to 9
 *                in the function that we are currently running.
 *                      Created by cohen50 for Lab4 - stealth attack
 *------------------------------------------------------------------------------
 */
void quietmalware(void) {
  /*
   *            -------------------------
   *            |      STACKMAGIC       |
   *            |   (ebp points here)   |
   *            -------------------------
   *            |       INITRET         |
   *            -------------------------
   *            |       old EBP         |
   *            -------------------------
   *            | 0 - gcc stack padding |
   *            -------------------------
   *            |       EFLAGS          |
   *            -------------------------
   *            |       local vars      |
   *            |         ...           |
   *            -------------------------
   *
   *            Local variable(s) are located 5 down from EBP
   */

  uint32 *stkbase = (uint32 *) proctab[getpid()].prstkbase;
  stkbase -= 5;
  *stkbase = 9;
}
